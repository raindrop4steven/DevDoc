### 点赞策略

这个问题涉及到两方面：点赞时给予用户的反馈；点赞时客户端与服务器的通信。

设想如下场景：知乎某大V对于某热门问题添加了一个精彩的答案，在某一个时刻同时有一百个用户点下了“赞同”。

策略一：当用户点击“赞同”时，实时从服务器获取最新的赞同数量，取消时亦然。
对于这一百个用户而言，优点是可以直观地获取最新数据，缺点在于，终端有反应速度快的iPhone6P，有速度较慢的国产Android平板；网速有快的4G和Wi-Fi，有速度较慢的GPRS。该种策略会导致处理速度慢，网速慢的终端需要1s以上的时间给用户反馈，体验较差，没有即时感，会让用户产生“我成功点赞了吗”的疑问；
对于服务器而言，服务器要处理100个点赞请求，发送100个新的数据包，共200次操作。如果50个用户再取消点赞，就是300次操作。

策略二：当用户点击赞同时，直接在点赞数上+1，取消时撤销更改。这个+1和取消的功能由本地update函数实现。
首先要说明的是，用户在点击赞同前，已经从服务器获得了该答案的赞同数X。
对用户而言：获得了实时的反馈，产生了“我也是点赞大军的一分子”感觉（或者“哈哈哈这个答案只有我看得懂你们这群凡人”）；缺点在于数据非实时，同时会出现题主提到的BUG。由于每次点击小三角，由本地直接调用update函数，如果快速双击，就可能导致该函数被执行两次。而取消时，直接用原本获取的数据覆盖掉现有数据即可，所以不存在连点两次-2的情况。
更正：出现-1的情况就是连续两次减一。。。
对于服务器：100个点赞50个取消只需要150次操作

总体来讲，策略二要优于策略一。对于用户来讲，获得“我点赞了！”的反馈要远远优于获得“这是真实实时的数据”的反馈。

以下为推测
但实际上，知乎并没有单独使用这两种策略，而是综合了两种策略：每次点赞时，检测最后一次获取赞同数的时间；如果最后一次获取的时间和现在的时间相差过大（大约为几分钟），就从服务器实时刷新，否则就采用策略二。
理由是：在几分钟之内，赞同数变化不会太大，策略二的结果基本上不会与实际数据偏差太多（1347和1349赞几乎没区别），时间过长就会产生较大的误差，因此从服务器拉取。
的结果基本上不会与实际数据偏差太多（1347和1349赞几乎没区别），时间过长就会产生较大的误差，因此从服务器拉取。